# 📝 人間承認型AIエージェントを備えたタスク管理アプリ

## 概要

本プロジェクトは、既存のタスク管理アプリに  
**「計画立案を担う AI エージェント」**を組み込んだポートフォリオである。

このエージェントは、

- タスクの締切情報をもとに  
- 複数ステップの判断を行い  
- 人間の承認を経て  
- Google Calendar に予定を反映する  

という **管理されたプロセス**として設計されている。

単なる AI 提案機能ではなく、  
**状態を持って進行するエージェント設計**を重視している。

---

## 解決したい課題

多くのタスク管理アプリでは、次の課題が残りがちである。

- タスクは登録できるが  
  **「いつ始めるべきか」が分からない**
- 締切直前になってから着手してしまう
- 計画立案が毎回属人的になる

本プロジェクトでは、  
**「締切から逆算して、着手日を決める」という重い意思決定**を  
AI エージェントに委ねることで、これらの課題を解決する。

---

## 本エージェントの特徴

### 1. 複数ステップの判断を行う

エージェントは単発の提案ではなく、以下の判断を順に行う。

- サブタスクへの分解  
- サブタスク間の優先度判断  
- 全体工数（日数）の見積もり  
- 締切から逆算した着手期限の算出  
- 着手候補日の生成と推薦  

---

### 2. 状態を持って進行する

エージェントの実行は **AgentRun** という単位で管理される。

AgentRun は、

- 今どこまで処理が進んでいるか  
- AI がどのような判断を行ったか  
- 人間がどの選択をしたか  

といった情報を保持し、  
**プロセス全体を一貫して追跡可能**にしている。

---

### 3. 人間の承認を前提とした設計

Google Calendar への登録は不可逆操作であるため、  
本エージェントでは **必ず人間の承認を挟む**。

人間は「ゼロから決める」のではなく、

- AI が提示した候補日を  
- **選択するだけ**

という形で関与する。

---

## ユーザーフロー

1. ユーザーがタスクを登録  
   （タスク名 / 優先度 / 締切日）

2. ユーザーが「エージェント起動」を実行

3. エージェント内部で以下を実行  
   - サブタスク生成  
   - 優先度判断  
   - 工数見積もり  

4. 締切から逆算して着手期限を算出

5. 着手候補日を 2〜3 日生成

6. AI が候補日の推薦順と理由を提示

7. ユーザーが候補日を 1 つ選択

8. 選択された日が  
   Google Calendar に **終日予定**として自動登録される

---

## Agent Design

### AgentRun

AgentRun は、  
**1つのタスクに対するエージェントの実行単位**である。

AgentRun が保持する主な情報：

- 工数見積もり結果とその理由（AI）
- 着手候補日
- 候補日の推薦順と理由（AI）
- 人間が選択した日
- 現在の状態

業務データ（Task / SubTask）とは分離し、  
**判断・意思決定の履歴のみを保持**する。

---

### ステップ構成

エージェントは次のステップで進行する。

1. サブタスク生成（AI）  
2. サブタスク優先度判断（AI）  
3. 工数見積もり（AI）  
4. 着手期限計算（コード）  
5. 候補日生成（コード）  
6. 候補日推薦（AI）  
7. 人間承認  
8. カレンダー登録（コード）

---

### 状態遷移

AgentRun は最小限の状態のみを持つ。

- `RUNNING`
- `WAITING_HUMAN_APPROVAL`
- `COMPLETED`
- `CANCELED`

途中再開や自動リトライは、本実装では行わない。

---

## 責任分離

### AI が担当すること

- サブタスク生成  
- 優先度判断  
- 工数見積もり  
- 候補日の推薦と理由付け  

---

### コードが担当すること

- 日付計算（締切逆算）  
- 候補日の列挙  
- 状態管理  
- Google Calendar への登録  

---

### 人間が担当すること

- 外部システムに反映する最終判断  

---

## Future Work

- サブタスク生成時の人間承認  
- 優先度判断への承認追加  
- 再計画（リスケジューリング）  
- 詰まり検知と自動提案  
- カレンダー情報を考慮した推薦  

これらは **AgentRun / Step 設計を拡張することで対応可能**である。


---


## ⭐ このアプリの最大の特徴

本アプリは  
**「AIを業務システムで安全に利用するための設計」**  
を最重要テーマとして構築しています。

詳細なエージェント設計については  
上部の「Agent Design」セクションを参照してください。


---

## 🔍 採用担当の方向け（このアプリで分かる私のスキル）

- フロント〜バック〜DB〜認証〜CI/CD まで すべて自走で構築
- JWT 認証／SecurityFilter／Token 検証など、実務レベルの認証ロジックを理解して実装
- React × TypeScript の型安全な設計（Custom Hooks、型定義、状態管理）
- Docker Compose による本番と同構成のローカル環境
- GitHub Actions（CI）＋ Render / Cloudflare Pages（CD）による自動デプロイ
- develop / main を分離した実務想定フロー
- UI/UX 改善（モーダル、フィルタ、優先度カラー、締切色分けなど）

React × TypeScript × Spring Boot × PostgreSQL × JWT × Docker × Cloudflare Pages × Render  
フロント〜バックエンド〜DB〜認証〜CI/CDまで  
完全自走で構築したフルスタックアプリケーションです。

---

## 🌐 アプリURL

フロントエンド（Cloudflare Pages）  
https://task-manager-7k8.pages.dev

バックエンド（Render / Docker）  
https://task-manager-uylj.onrender.com

---

## ✨ アプリ概要

タスクの  
登録 / 編集 / 削除 / 完了管理 / 優先度 / 締切管理 / ソート / フィルタリング  
が可能なタスク管理アプリです。

JWT 認証（ログイン / 新規登録 / 認証付きタスクAPI）を実装し、  
実務レベルの認証・認可設計を取り入れています。

---

## 🔐 JWT 認証機能

新規登録（/auth/register）  
- メール & パスワードで登録  
- BCrypt によるパスワードハッシュ化  
- 登録後すぐに JWT を自動発行  

ログイン（/auth/login）  
- 認証成功で JWT を返却  
- フロントは localStorage に保存  
- axios Interceptor により Authorization ヘッダを自動付与  

認証必須 API（/api/tasks/**）  
- タスク取得 / 作成 / 更新 / 削除  
- すべて JWT 必須  

ゲストモード  
- 未ログインでも利用可能  
- /api/tasks/public を用意  
- ログイン状態に応じて API を自動切替  

---

## 🤖 AIによるタスク状態判断（既存機能）

※ 本機能は、Agent Design とは別に実装されている
AIによる意思決定支援機能です。

AIはタスク状態を自動で変更はせず、  
人間の意思決定を支援する役割として組み込んでいます。

AIによるタスク状態判断

### AI意思決定フロー

1. ユーザーが「AI判定」をクリック  
2. AI が以下を元に判断  
   - タスク名  
   - 優先度  
   - 締切日  
   - 現在の状態（PENDING / EXECUTING / DONE）  
3. AI が次に取るべき状態と理由を返却  
4. ユーザーが内容を確認し「この提案を反映」をクリック  
5. タスク状態を更新  

---

## 🧠 設計思想

- AIによる自動状態変更は行わない
- 必ず人間が承認してから反映
- AIの判断結果はすべてDBに保存
- 後から判断理由を追跡可能

「AIがそう言ったから」では説明責任を果たせないため、  
AIを意思決定支援ツールとして位置づけています。

---

## 📜 AI判断ログ（監査・説明可能性）

AI の提案内容はすべて DB に保存し、  
人間が承認したかどうかに関わらず履歴を保持します。

ログ項目  
- task_id  
- suggested_state  
- reason  
- created_at  

ログ取得 API  
GET /api/tasks/{taskId}/ai/logs  
Authorization: Bearer <JWT>

---

## 🧠 AIプロンプト設計

- JSON 形式のみ返却
- 状態遷移を厳密に制限
- DONE 状態は変更不可
- 判断理由は日本語で簡潔に出力

レスポンス例  
  {
    "nextState": "EXECUTING",
    "reason": "優先度が高く、締切が近いため今すぐ着手すべきと判断しました。"
  }

---

## 🐳 インフラ / デプロイ構成

- Docker Compose（Front / API / DB）
- Cloudflare Pages（Frontend）
- Render（API / PostgreSQL）
- GitHub Actions（CI）
- Render Deploy Hook（CD）

---

## 📦 ローカル環境構築

すべて起動  
docker compose up --build

フロントのみ  
cd frontend  
npm install  
npm run dev  

バックエンドのみ  
cd backend  
./mvnw spring-boot:run  

---

## 📘 今後の改善予定

- Refresh Token 対応  
- 権限管理（ROLE_USER / ROLE_ADMIN）  
- AI判断ログへの userId 付与  
- 例外ハンドリング統一  
- バリデーション強化  
- E2E テスト（Cypress / Playwright）  
- タグ・担当者機能  

---

## 📄 ライセンス

MIT License
